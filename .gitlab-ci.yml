---
include:
  - project: nci-gdc/gitlab-templates
    ref: 0.6.2
    file:
      - templates/global/full.yaml
      - templates/python/full.yaml
      - templates/common/python.yaml

tox:
  parallel:
    matrix:
      - BUILD_PY_VERSION:
          - python3.8
  script:
    - tox -r -e py

release:
  variables:
    RELEASE_PY_VERSION: python3.8
  before_script:
    # unshallow the git repo to resolve version with setuptools_scm.
    - git fetch --unshallow || true
  after_script:
    - pip install "setuptools_scm>=6.2,<8" "setuptools-git-versioning<2"
    - python -m setuptools_git_versioning | tee VERSION.txt
  artifacts:
    paths:
      - VERSION.txt
    expire_in: 1 week
